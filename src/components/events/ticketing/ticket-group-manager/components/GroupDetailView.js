import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useTranslation } from 'react-i18next';
import { Plus, GripVertical, Copy, Trash2, Ticket } from 'lucide-react';
import { Button } from '@/components/common/shadcn/button';
import { Input } from '@/components/common/shadcn/input';
import { Card, CardHeader } from '@/components/common/shadcn/card';
import { Badge } from '@/components/common/shadcn/badge';
import { FmI18nCommon } from '@/components/common/i18n';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue, } from '@/components/common/shadcn/select';
import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger, } from '@/components/common/shadcn/tooltip';
import { cn } from '@/shared';
import { GROUP_COLORS, NO_GROUP_ID } from '../constants';
import { formatPrice, getTotalTicketsInGroup, getTotalRevenueInGroup } from '../utils';
import { TierListItem } from './TierListItem';
export function GroupDetailView({ group, isOnlyGroup, allGroups, onUpdateGroup, onDuplicateGroup, onDeleteGroup, onAddTier, onUpdateTier, onDuplicateTier, onDeleteTier, }) {
    const { t } = useTranslation('common');
    const colorConfig = GROUP_COLORS.find(c => c.value === group.color) || GROUP_COLORS[0];
    const isNoGroup = group.id === NO_GROUP_ID;
    const totalTiersAcrossAllGroups = allGroups.reduce((sum, g) => sum + g.tiers.length, 0);
    return (_jsxs("div", { className: 'space-y-6', children: [_jsx(Card, { className: cn('border-2', colorConfig.value), children: _jsx(CardHeader, { children: _jsxs("div", { className: 'flex items-start justify-between gap-4', children: [_jsxs("div", { className: 'flex items-start gap-3 flex-1', children: [_jsx(TooltipProvider, { children: _jsxs(Tooltip, { children: [_jsx(TooltipTrigger, { asChild: true, children: _jsx("button", { className: 'mt-1 cursor-grab active:cursor-grabbing hover:text-fm-gold transition-colors', children: _jsx(GripVertical, { className: 'h-5 w-5' }) }) }), _jsx(TooltipContent, { children: _jsx("p", { children: t('ticketGroupManager.dragToReorder') }) })] }) }), _jsxs("div", { className: 'flex-1 space-y-3', children: [_jsxs("div", { className: 'flex items-center gap-2', children: [_jsx(Input, { value: group.name, onChange: e => onUpdateGroup({ name: e.target.value }), className: 'font-semibold text-lg bg-background/50', placeholder: t('ticketGroupManager.groupNamePlaceholder') }), _jsxs(Select, { value: group.color, onValueChange: value => onUpdateGroup({ color: value }), children: [_jsx(SelectTrigger, { className: 'w-32', children: _jsx(SelectValue, {}) }), _jsx(SelectContent, { children: GROUP_COLORS.map(color => (_jsx(SelectItem, { value: color.value, children: _jsxs("div", { className: 'flex items-center gap-2', children: [_jsx("div", { className: cn('w-4 h-4 rounded-full', color.value) }), color.name] }) }, color.value))) })] })] }), _jsx(Input, { value: group.description, onChange: e => onUpdateGroup({ description: e.target.value }), className: 'text-sm bg-background/50', placeholder: t('ticketGroupManager.groupDescriptionPlaceholder') }), _jsxs("div", { className: 'flex items-center gap-4 text-sm', children: [_jsxs(Badge, { variant: 'outline', children: [_jsx(Ticket, { className: 'h-3 w-3 mr-1' }), t('ticketGroupManager.tiersCount', { count: group.tiers.length })] }), _jsx(Badge, { variant: 'outline', children: t('ticketGroupManager.ticketsCount', { count: getTotalTicketsInGroup(group) }) }), _jsxs(Badge, { variant: 'outline', className: 'text-fm-gold border-fm-gold/50', children: [formatPrice(getTotalRevenueInGroup(group)), " ", t('ticketGroupManager.revenue')] })] })] })] }), _jsxs("div", { className: 'flex items-center gap-1', children: [_jsx(TooltipProvider, { children: _jsxs(Tooltip, { children: [_jsx(TooltipTrigger, { asChild: true, children: _jsx(Button, { variant: 'ghost', size: 'sm', onClick: onDuplicateGroup, children: _jsx(Copy, { className: 'h-4 w-4' }) }) }), _jsx(TooltipContent, { children: _jsx("p", { children: t('ticketGroupManager.duplicateGroup') }) })] }) }), _jsx(TooltipProvider, { children: _jsxs(Tooltip, { children: [_jsx(TooltipTrigger, { asChild: true, children: _jsx(Button, { variant: 'ghost', size: 'sm', onClick: onDeleteGroup, disabled: isOnlyGroup || isNoGroup, children: _jsx(Trash2, { className: 'h-4 w-4 text-destructive' }) }) }), _jsx(TooltipContent, { children: _jsx("p", { children: t('ticketGroupManager.deleteGroup') }) })] }) })] })] }) }) }), _jsxs("div", { className: 'space-y-4', children: [_jsx(FmI18nCommon, { i18nKey: 'ticketGroupManager.ticketTiers', as: 'h4', className: 'text-lg font-semibold' }), group.tiers.map((tier, tierIndex) => {
                        // Last tier in No Group and only tier in entire system cannot be deleted
                        const isLastTierInSystem = isNoGroup && group.tiers.length === 1 && totalTiersAcrossAllGroups === 1;
                        return (_jsx(TierListItem, { tier: tier, tierIndex: tierIndex, isFirstTier: tierIndex === 0, isOnlyTier: group.tiers.length === 1, isProtected: isLastTierInSystem, onUpdate: updates => onUpdateTier(tierIndex, updates), onDuplicate: () => onDuplicateTier(tierIndex), onDelete: () => onDeleteTier(tierIndex) }, `${group.id}-tier-${tierIndex}`));
                    }), _jsxs(Button, { variant: 'outline', size: 'sm', onClick: onAddTier, className: 'w-full border-dashed hover:border-fm-gold hover:text-fm-gold', children: [_jsx(Plus, { className: 'h-4 w-4 mr-2' }), t('ticketGroupManager.addTierToGroup', { groupName: group.name })] })] })] }));
}
